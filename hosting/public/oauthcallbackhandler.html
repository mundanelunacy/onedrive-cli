<html>
  <head>
    <title>Simple OAuth2.0 callback handler</title>
    <script>
(function(){

  var textarea;

  function click(e) {

    textarea.setSelectionRange(0, textarea.value.length)
    textarea.focus();
    return document.execCommand('copy');
  }

  function init() {
    var hash = window.location.hash || '';
    var query = window.location.search || '';
    var params = new URLSearchParams(hash.replace(/^#/, ''));
    var queryParams = new URLSearchParams(query.replace(/^\?/, ''));
    var access_token = params.get('access_token');
    var code = params.get('code') || queryParams.get('code');

    textarea = document.getElementById('token')
    if (code) {
      textarea.value = " onedrive-cli login code "+decodeURIComponent(code);
    } else if (access_token) {
      textarea.value = " onedrive-cli login "+decodeURIComponent(access_token);
    } else {
      textarea.value = "Unable to find access token or authorization code in the URL."
    }
    textarea.focus();

    document.getElementById('copy').addEventListener('click', click);
  }

  window.addEventListener('load', init);
})();
    </script>
  </head>
  <body>
    <p>Copy-paste this token in the command line:</p>
    <textarea id='token' readonly="readonly" style="height: 20em; width:50%"></textarea>
    <button id='copy'>Copy</button>
  </body>
</html>
